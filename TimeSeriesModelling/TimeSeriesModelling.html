<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>timeseriesmodelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="TimeSeriesModelling_files/libs/clipboard/clipboard.min.js"></script>
<script src="TimeSeriesModelling_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="TimeSeriesModelling_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="TimeSeriesModelling_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="TimeSeriesModelling_files/libs/quarto-html/popper.min.js"></script>
<script src="TimeSeriesModelling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TimeSeriesModelling_files/libs/quarto-html/anchor.min.js"></script>
<link href="TimeSeriesModelling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TimeSeriesModelling_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TimeSeriesModelling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TimeSeriesModelling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TimeSeriesModelling_files/libs/bootstrap/bootstrap-16dd2175dec9f4dc951dbe4baff485c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#time-series-modelling" id="toc-time-series-modelling" class="nav-link active" data-scroll-target="#time-series-modelling"><strong>Time Series Modelling</strong></a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key findings</a></li>
  <li><a href="#abstract" id="toc-abstract" class="nav-link" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#data-sets" id="toc-data-sets" class="nav-link" data-scroll-target="#data-sets">Data sets</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="TimeSeriesModelling.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">




<div id="012c7687-f574-4dab-9e03-dda89814a224" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, message<span class="op">=</span><span class="st">".*'M' is deprecated.*"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, message<span class="op">=</span><span class="st">".*'Q-DEC' is deprecated.*"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> get_basedir, load_nlb_npl_data, fill_missing_values, resample_monthly_to_quarterly, compute_time_distance, get_eurostat_time_unit</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotting_functions <span class="im">import</span> plot_nlb_and_eurostat_data, plot_df_head_table, plot_model_coefficients_table, plot_abs_coeff_series_by_dataset, plot_npl_predictions</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> get_basedir()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="time-series-modelling" class="level1">
<h1><strong>Time Series Modelling</strong></h1>
<p><strong>Author:</strong> Ivan Kukuljan <strong>Date:</strong> October 14, 2025</p>
<p><strong>Recruiting assignment at the NLB Group</strong></p>
<hr>
<section id="key-findings" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="key-findings">Key findings</h2>
<ul>
<li>Among macroeconomic variables, the Non-Performing Loans (NPL) are most strongly influenced by the Gross domestic product, Unemployment Rate and House price index</li>
<li>The model correctly captures different NPL regimes - the Euro crisis and the post crisis period</li>
<li>The model has a future predictive power of two quarters</li>
</ul>
</section>
<section id="abstract" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract">Abstract</h2>
<p>Non-Performing Loans (NPL) is one the most important indicators in bank. It reflects loans where the borrowers have stopped making payments for an extended period. Here we model the dependence of the NPL of Nova Ljubljanska Banka on most important macroeconomic variables in the period of 2008-2022. We develop a linear model with delay. We test the model on two non-overlapping test sets: test set 1 - missing data inside of the modelling period, test set 2 - future period. The model achieves the <span class="math inline">\(R^2\)</span> score of 0.8645 inside of the modelling period, while it is only able to predict two quarters ahead in the future period. Gross domestic product, Unemployment Rate and House price index are identified as main macroeconomic drivers of the NPL.</p>
</section>
<section id="data-sets" class="level2">
<h2 class="anchored" data-anchor-id="data-sets">Data sets</h2>
<p>The NPL data of Nova Ljubljanska Banka have been provided by NLB. They are quarterly data giving the date and the NLP values for the period 2008-2022.</p>
<p>We choose the following set of macroeconomic variables from the Eurostat database:</p>
<ul>
<li>Gross domestic product (GDP) (2015 = 100) - nama_10_gdp, annual - representing health of the national economy</li>
<li>Gross domestic product (GDP) (percentage change on previous) - nama_10_gdp, annual - representing the trend in the national economy</li>
<li>Unemployment Rate - une_rt_q, quarterly</li>
<li>House price index (2015 = 100) - prc_hpi_q, quarterly</li>
<li>Harmonised Index of Consumer Prices (annual rate of change) - prc_hicp_manr, monthly</li>
<li>Private sectror credit flow - tipspc10, annual</li>
<li>Money Market Interest Rate - irt_st_m, monthly</li>
<li>Consumer confidence indicator - ei_bsco_m, monthly</li>
</ul>
<p>We have considered several other macroeconomic variables, like Government deficit/surplus, Consumer confidence - financial last 12 months, Consumer confidence - financial next 12 months. However, they have turned out to have less influence on the NPL.</p>
<p>NLB is operating on a wide market, consisting of Slovenia, Serbia, Croatia, Bosnia and Herzegovina, Macedonia, Montenegro and Kosovo. Unfortunately, since not all of these countries are member states of the EU, Eurostat is not keeping consistent statistics of all of them. While some data sets are available fo some of them, many data sets are missing, or have only been kept in the recent years. For simplicity, we therefore choose to model the NPL using macroeconomic variables for Slovenia, where 62% of NLBâ€™s banking assets are located [NLB Group Presentation, 1H 2025 Financial Results].</p>
<p>The time series of the NLB NPL rates as well as the chosen macroeconomic variables are shown in the Figure 1 below.</p>
<p>The chosen data sets have different frequencies. For consistency and in order to reduce the number of parameters of the model, we choose to transform monthly datasets into quarterly. Annual data sets are treated as annual as described below. For the stability of the model, we scale the data sets to have zero mean and unit variance.</p>
<p>We split the data into non-overlapping train set and two test sets. The train set and the test set 1 are randomly split data entries for the period 2008 until 2021-Q2. The test set 2 consists of all the data entries for the period 2021-Q3 until 2022-Q4. The purpose of the test set 1 is to test the validity of the model inside of the period where it has been optimized. The purpose of the test set 2 is to test the performance of the model for the future predictions.</p>
<div id="2913b25e-6359-4234-99c5-92872c1b9d50" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>eurostat_datasets <span class="op">=</span> {<span class="st">'Gross domestic product (GDP) (2015 = 100)'</span> :</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>{<span class="st">'dataset_code'</span> : <span class="st">'nama_10_gdp'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">'frequency'</span> : <span class="st">'a'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_gdp/1.0/*.*.*.*?c[freq]=A&amp;c[unit]=CLV_I15&amp;c[na_item]=B1GQ&amp;c[geo]=SI&amp;c[TIME_PERIOD]=2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">'fill_missing'</span> : <span class="va">True</span>},</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">'Gross domestic product (GDP) (percentage change on previous)'</span> :    </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>{<span class="st">'dataset_code'</span> : <span class="st">'nama_10_gdp'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">'frequency'</span> : <span class="st">'a'</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/nama_10_gdp/1.0/*.*.*.*?c[freq]=A&amp;c[unit]=CLV_PCH_PRE&amp;c[na_item]=B1GQ&amp;c[geo]=SI&amp;c[TIME_PERIOD]=2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">'fill_missing'</span> : <span class="va">True</span>},</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'Unemployment Rate'</span> :</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a> {<span class="st">'dataset_code'</span> : <span class="st">'une_rt_q'</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'frequency'</span> : <span class="st">'q'</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/une_rt_q/1.0/*.*.*.*.*.*?c[freq]=Q&amp;c[s_adj]=SA&amp;c[age]=Y20-64&amp;c[unit]=PC_ACT&amp;c[sex]=T&amp;c[geo]=SI&amp;c[TIME_PERIOD]=ge:2006-Q1+le:2023-Q4&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'fill_missing'</span> : <span class="va">False</span>},</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'House price index (2015 = 100)'</span> : </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a> {<span class="st">'dataset_code'</span> : <span class="st">'prc_hpi_q'</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'frequency'</span> : <span class="st">'q'</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/prc_hpi_q/1.0/*.*.*.*?c[freq]=Q&amp;c[purchase]=TOTAL&amp;c[unit]=I15_Q&amp;c[geo]=SI&amp;c[TIME_PERIOD]=2023-Q4,2023-Q3,2023-Q2,2023-Q1,2022-Q4,2022-Q3,2022-Q2,2022-Q1,2021-Q4,2021-Q3,2021-Q2,2021-Q1,2020-Q4,2020-Q3,2020-Q2,2020-Q1,2019-Q4,2019-Q3,2019-Q2,2019-Q1,2018-Q4,2018-Q3,2018-Q2,2018-Q1,2017-Q4,2017-Q3,2017-Q2,2017-Q1,2016-Q4,2016-Q3,2016-Q2,2016-Q1,2015-Q4,2015-Q3,2015-Q2,2015-Q1,2014-Q4,2014-Q3,2014-Q2,2014-Q1,2013-Q4,2013-Q3,2013-Q2,2013-Q1,2012-Q4,2012-Q3,2012-Q2,2012-Q1,2011-Q4,2011-Q3,2011-Q2,2011-Q1,2010-Q4,2010-Q3,2010-Q2,2010-Q1,2009-Q4,2009-Q3,2009-Q2,2009-Q1,2008-Q4,2008-Q3,2008-Q2,2008-Q1,2007-Q4,2007-Q3,2007-Q2,2007-Q1,2006-Q4,2006-Q3,2006-Q2,2006-Q1&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'fill_missing'</span> : <span class="va">True</span>},</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'Harmonised Index of Consumer Prices (annual rate of change)'</span>:</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a> {<span class="st">'dataset_code'</span> : <span class="st">'prc_hicp_manr'</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'frequency'</span> : <span class="st">'m'</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/prc_hicp_manr/1.0/*.*.*.*?c[freq]=M&amp;c[unit]=RCH_A&amp;c[coicop]=CP00&amp;c[geo]=SI&amp;c[TIME_PERIOD]=2023-12,2023-11,2023-10,2023-09,2023-08,2023-07,2023-06,2023-05,2023-04,2023-03,2023-02,2023-01,2022-12,2022-11,2022-10,2022-09,2022-08,2022-07,2022-06,2022-05,2022-04,2022-03,2022-02,2022-01,2021-12,2021-11,2021-10,2021-09,2021-08,2021-07,2021-06,2021-05,2021-04,2021-03,2021-02,2021-01,2020-12,2020-11,2020-10,2020-09,2020-08,2020-07,2020-06,2020-05,2020-04,2020-03,2020-02,2020-01,2019-12,2019-11,2019-10,2019-09,2019-08,2019-07,2019-06,2019-05,2019-04,2019-03,2019-02,2019-01,2018-12,2018-11,2018-10,2018-09,2018-08,2018-07,2018-06,2018-05,2018-04,2018-03,2018-02,2018-01,2017-12,2017-11,2017-10,2017-09,2017-08,2017-07,2017-06,2017-05,2017-04,2017-03,2017-02,2017-01,2016-12,2016-11,2016-10,2016-09,2016-08,2016-07,2016-06,2016-05,2016-04,2016-03,2016-02,2016-01,2015-12,2015-11,2015-10,2015-09,2015-08,2015-07,2015-06,2015-05,2015-04,2015-03,2015-02,2015-01,2014-12,2014-11,2014-10,2014-09,2014-08,2014-07,2014-06,2014-05,2014-04,2014-03,2014-02,2014-01,2013-12,2013-11,2013-10,2013-09,2013-08,2013-07,2013-06,2013-05,2013-04,2013-03,2013-02,2013-01,2012-12,2012-11,2012-10,2012-09,2012-08,2012-07,2012-06,2012-05,2012-04,2012-03,2012-02,2012-01,2011-12,2011-11,2011-10,2011-09,2011-08,2011-07,2011-06,2011-05,2011-04,2011-03,2011-02,2011-01,2010-12,2010-11,2010-10,2010-09,2010-08,2010-07,2010-06,2010-05,2010-04,2010-03,2010-02,2010-01,2009-12,2009-11,2009-10,2009-09,2009-08,2009-07,2009-06,2009-05,2009-04,2009-03,2009-02,2009-01,2008-12,2008-11,2008-10,2008-09,2008-08,2008-07,2008-06,2008-05,2008-04,2008-03,2008-02,2008-01,2007-12,2007-11,2007-10,2007-09,2007-08,2007-07,2007-06,2007-05,2007-04,2007-03,2007-02,2007-01,2006-12,2006-11,2006-10,2006-09,2006-08,2006-07,2006-06,2006-05,2006-04,2006-03,2006-02,2006-01&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'resample_method'</span> : <span class="st">'mean'</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'fill_missing'</span> : <span class="va">True</span>},</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'Private sectror credit flow'</span>:</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a> {<span class="st">'dataset_code'</span> : <span class="st">'tipspc10'</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'frequency'</span> : <span class="st">'a'</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/tipspc10/1.0/*.*.*.*.*.*.*?c[freq]=A&amp;c[co_nco]=CO&amp;c[sector]=S11_S14_S15&amp;c[finpos]=LIAB&amp;c[na_item]=F3_F4&amp;c[unit]=PC_GDP&amp;c[geo]=SI&amp;c[TIME_PERIOD]=2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'fill_missing'</span> : <span class="va">True</span>},    </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'Money Market Interest Rate'</span> : </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a> {<span class="st">'dataset_code'</span> : <span class="st">'irt_st_m'</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a> <span class="st">'frequency'</span> : <span class="st">'m'</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a> <span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/irt_st_m/1.0/*.*.*?c[freq]=M&amp;c[int_rt]=IRT_M12&amp;c[geo]=EA&amp;c[TIME_PERIOD]=2023-12,2023-11,2023-10,2023-09,2023-08,2023-07,2023-06,2023-05,2023-04,2023-03,2023-02,2023-01,2022-12,2022-11,2022-10,2022-09,2022-08,2022-07,2022-06,2022-05,2022-04,2022-03,2022-02,2022-01,2021-12,2021-11,2021-10,2021-09,2021-08,2021-07,2021-06,2021-05,2021-04,2021-03,2021-02,2021-01,2020-12,2020-11,2020-10,2020-09,2020-08,2020-07,2020-06,2020-05,2020-04,2020-03,2020-02,2020-01,2019-12,2019-11,2019-10,2019-09,2019-08,2019-07,2019-06,2019-05,2019-04,2019-03,2019-02,2019-01,2018-12,2018-11,2018-10,2018-09,2018-08,2018-07,2018-06,2018-05,2018-04,2018-03,2018-02,2018-01,2017-12,2017-11,2017-10,2017-09,2017-08,2017-07,2017-06,2017-05,2017-04,2017-03,2017-02,2017-01,2016-12,2016-11,2016-10,2016-09,2016-08,2016-07,2016-06,2016-05,2016-04,2016-03,2016-02,2016-01,2015-12,2015-11,2015-10,2015-09,2015-08,2015-07,2015-06,2015-05,2015-04,2015-03,2015-02,2015-01,2014-12,2014-11,2014-10,2014-09,2014-08,2014-07,2014-06,2014-05,2014-04,2014-03,2014-02,2014-01,2013-12,2013-11,2013-10,2013-09,2013-08,2013-07,2013-06,2013-05,2013-04,2013-03,2013-02,2013-01,2012-12,2012-11,2012-10,2012-09,2012-08,2012-07,2012-06,2012-05,2012-04,2012-03,2012-02,2012-01,2011-12,2011-11,2011-10,2011-09,2011-08,2011-07,2011-06,2011-05,2011-04,2011-03,2011-02,2011-01,2010-12,2010-11,2010-10,2010-09,2010-08,2010-07,2010-06,2010-05,2010-04,2010-03,2010-02,2010-01,2009-12,2009-11,2009-10,2009-09,2009-08,2009-07,2009-06,2009-05,2009-04,2009-03,2009-02,2009-01,2008-12,2008-11,2008-10,2008-09,2008-08,2008-07,2008-06,2008-05,2008-04,2008-03,2008-02,2008-01,2007-12,2007-11,2007-10,2007-09,2007-08,2007-07,2007-06,2007-05,2007-04,2007-03,2007-02,2007-01,2006-12,2006-11,2006-10,2006-09,2006-08,2006-07,2006-06,2006-05,2006-04,2006-03,2006-02,2006-01&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a> <span class="st">'unit_column_name'</span> : <span class="st">'Interest rate'</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a> <span class="st">'resample_method'</span> : <span class="st">'last'</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a> <span class="st">'fill_missing'</span> : <span class="va">True</span>},</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a> <span class="st">'Consumer confidence indicator'</span>:</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a> {<span class="st">'dataset_code'</span> : <span class="st">'ei_bsco_m'</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a> <span class="st">'frequency'</span> : <span class="st">'m'</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a> <span class="st">'url'</span> : <span class="st">'https://ec.europa.eu/eurostat/api/dissemination/sdmx/3.0/data/dataflow/ESTAT/ei_bsco_m/1.0/*.*.*.*.*?c[freq]=M&amp;c[indic]=BS-CSMCI&amp;c[s_adj]=SA&amp;c[unit]=BAL&amp;c[geo]=SI&amp;c[TIME_PERIOD]=2023-12,2023-11,2023-10,2023-09,2023-08,2023-07,2023-06,2023-05,2023-04,2023-03,2023-02,2023-01,2022-12,2022-11,2022-10,2022-09,2022-08,2022-07,2022-06,2022-05,2022-04,2022-03,2022-02,2022-01,2021-12,2021-11,2021-10,2021-09,2021-08,2021-07,2021-06,2021-05,2021-04,2021-03,2021-02,2021-01,2020-12,2020-11,2020-10,2020-09,2020-08,2020-07,2020-06,2020-05,2020-04,2020-03,2020-02,2020-01,2019-12,2019-11,2019-10,2019-09,2019-08,2019-07,2019-06,2019-05,2019-04,2019-03,2019-02,2019-01,2018-12,2018-11,2018-10,2018-09,2018-08,2018-07,2018-06,2018-05,2018-04,2018-03,2018-02,2018-01,2017-12,2017-11,2017-10,2017-09,2017-08,2017-07,2017-06,2017-05,2017-04,2017-03,2017-02,2017-01,2016-12,2016-11,2016-10,2016-09,2016-08,2016-07,2016-06,2016-05,2016-04,2016-03,2016-02,2016-01,2015-12,2015-11,2015-10,2015-09,2015-08,2015-07,2015-06,2015-05,2015-04,2015-03,2015-02,2015-01,2014-12,2014-11,2014-10,2014-09,2014-08,2014-07,2014-06,2014-05,2014-04,2014-03,2014-02,2014-01,2013-12,2013-11,2013-10,2013-09,2013-08,2013-07,2013-06,2013-05,2013-04,2013-03,2013-02,2013-01,2012-12,2012-11,2012-10,2012-09,2012-08,2012-07,2012-06,2012-05,2012-04,2012-03,2012-02,2012-01,2011-12,2011-11,2011-10,2011-09,2011-08,2011-07,2011-06,2011-05,2011-04,2011-03,2011-02,2011-01,2010-12,2010-11,2010-10,2010-09,2010-08,2010-07,2010-06,2010-05,2010-04,2010-03,2010-02,2010-01,2009-12,2009-11,2009-10,2009-09,2009-08,2009-07,2009-06,2009-05,2009-04,2009-03,2009-02,2009-01,2008-12,2008-11,2008-10,2008-09,2008-08,2008-07,2008-06,2008-05,2008-04,2008-03,2008-02,2008-01,2007-12,2007-11,2007-10,2007-09,2007-08,2007-07,2007-06,2007-05,2007-04,2007-03,2007-02,2007-01,2006-12,2006-11,2006-10,2006-09,2006-08,2006-07,2006-06,2006-05,2006-04,2006-03,2006-02,2006-01&amp;compress=false&amp;format=csvdata&amp;formatVersion=2.0&amp;lang=en&amp;labels=name'</span>,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a> <span class="st">'unit_column_name'</span> : <span class="st">'Unit of measure'</span>,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a> <span class="st">'resample_method'</span> : <span class="st">'mean'</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a> <span class="st">'fill_missing'</span> : <span class="va">True</span>}</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> retrieve_eurostat_dataset(dataset_dict):</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads, checks, cleans, rescales, and adds useful fields for a Eurostat dataset.</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="co">    dataset_dict : dict</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Must contain at least:</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'url': csv file location</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'fill_missing': value or None to use for missing fills</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'resample_method': 'mean' or 'last' if resampling is required</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">    dataset_dict : dict</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="co">        Updated in place to contain:</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'times': list of period labels (str or yy-mm/yy-q)</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'values': list of values, as originally present</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'scaled_values': normalized values (zero mean/unit variance)</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'scaler_mean', 'scaler_scale': mean/scale used to standardize</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="co">        Or None upon error.</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> dataset_dict[<span class="st">'url'</span>]  <span class="co"># Path to the raw Eurostat CSV data</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    time_column_name <span class="op">=</span> <span class="st">'TIME_PERIOD'</span>        <span class="co"># Name of the time column</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    value_column_name <span class="op">=</span> <span class="st">'OBS_VALUE'</span>         <span class="co"># Name of the value column</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    country_column_name <span class="op">=</span> <span class="st">'Geopolitical entity (reporting)'</span>  <span class="co"># Name of the country col</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the CSV file into a DataFrame</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the dataset only covers a single country (before resampling)</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> country_column_name <span class="kw">in</span> df.columns:</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        countries <span class="op">=</span> pd.unique(df[country_column_name].dropna())</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(countries) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Error: more than one country in the dataset'</span>)</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(countries) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Error: no country in the dataset'</span>)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill missing values if a fill_missing policy is specified</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dataset_dict[<span class="st">'fill_missing'</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> fill_missing_values(df, dataset_dict[<span class="st">'fill_missing'</span>])</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Resample to quarterly, monthly, or other target frequency if needed</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dataset_dict.get(<span class="st">'resample_method'</span>):</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> resample_monthly_to_quarterly(</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>            df,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>            resampling_perscription<span class="op">=</span>dataset_dict[<span class="st">'resample_method'</span>],</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>            fill_missing<span class="op">=</span>dataset_dict[<span class="st">'fill_missing'</span>]</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract "times" and "values" to lists from the (possibly resampled) DataFrame</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> df[time_column_name].tolist()</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> df[value_column_name].tolist()</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert original values to floating point numpy array for scaling</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> pd.to_numeric(df[value_column_name], errors<span class="op">=</span><span class="st">'coerce'</span>).to_numpy()</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize the series (zero mean, unit variance)</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    scaled <span class="op">=</span> scaler.fit_transform(vals.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).ravel()</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Attach processed arrays and stats to the dictionary (side-effect!)</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    dataset_dict[<span class="st">'times'</span>] <span class="op">=</span> times</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    dataset_dict[<span class="st">'values'</span>] <span class="op">=</span> values</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    dataset_dict[<span class="st">'scaled_values'</span>] <span class="op">=</span> scaled.tolist()</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    dataset_dict[<span class="st">'scaler_mean'</span>] <span class="op">=</span> <span class="bu">float</span>(scaler.mean_[<span class="dv">0</span>])</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    dataset_dict[<span class="st">'scaler_scale'</span>] <span class="op">=</span> <span class="bu">float</span>(scaler.scale_[<span class="dv">0</span>])</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dataset_dict</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> eurostat_datasets:</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    dataset_dict <span class="op">=</span> eurostat_datasets[key]</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    dataset_dict <span class="op">=</span> retrieve_eurostat_dataset(dataset_dict)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    eurostat_datasets[key] <span class="op">=</span> dataset_dict</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>plot_nlb_and_eurostat_data(eurostat_datasets, output_path<span class="op">=</span>os.path.join(BASE_DIR, <span class="st">'plots'</span>, <span class="st">'data_plots.png'</span>))  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TimeSeriesModelling_files/figure-html/cell-3-output-1.png" width="1619" height="1084" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 1.</strong> Time series of the Non-Performing Loans (NPL) of Nova Ljubljanska Banka (NLB) for the period 2008-2022 and the macroeconomic variables from the Eurostat database chosen for the modelling of the NPL.</p>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<p>We choose to model the NPL using the macroeconomic variables with a linear model with delayed action. There are two important reasons for choosing a linear model:</p>
<ul>
<li>A linear model offers a large amount of <strong>explainability</strong> and <strong>interpretability</strong>. In particular it allows us to easily extract the importance of different macroeconomic variables.</li>
<li>A linear model is the most <strong>robust</strong> choice given that the NPL dataset is rather small consisting of only 60 data points. A more complex nonlinear model would come with a much larger set of parameters making it impossible to extract them without huge errors or even making the set of equations undetermined.</li>
</ul>
<p>We build the following model: <span class="math display">\[
\begin{align}
\text{NPL}(t) &amp;= \text{offset} + \sum_{d=1}^{D_{\text{NPL}}} K_{t-d}^{\text{NPL}}\cdot \text{NPL}(t-d) \\
&amp;\quad + \sum_{\text{quarterly variables}}\sum_{d=0}^{D_{\text{quarterly}}} K_{t-d}^{\text{var.}}\cdot \text{variable}(t-d) \\
&amp;\quad + \sum_{\text{annual variables}}\sum_{d=0}^{D_{\text{annual}}} K_{t-d}^{\text{var.}}\cdot \text{variable}(t-d)
\end{align}
\]</span></p>
<p>where <span class="math inline">\(D_{\text{NPL}}\)</span>, <span class="math inline">\(D_{\text{quarterly}}\)</span>, <span class="math inline">\(D_{\text{annual}}\)</span> are the maximal delays for the corresponding variable. They represent the window in which the past values of the variables can influence the current value of NPL. Our analysis at different values of the delay parameters has shown that the model performs best at <span class="math inline">\(D_{\text{NPL}}=2\text{ quarters}\)</span>, <span class="math inline">\(D_{\text{quarterly}}=2\text{ quarters}\)</span>, <span class="math inline">\(D_{\text{annual}}=1\text{ year}\)</span>. This means that the value of NPL is dependent on the value of itself and quarterly variables from the period of up to 2 quarters (6 months) in the past and on the annual variables for up to a year in the past. The coefficients <span class="math inline">\(K_{\tau}^{\alpha}\)</span> and offset are parameters of the model that are determined through the optimization - linear regression.</p>
<p>Our data manipulation proceeds by collecting NPL time points and all the variables values that are within the windows allowed by the delays. This is completed by the code below and the first few rows of such an object are presented in the Table 1.</p>
<div id="ed4bed18-9fc3-4e46-a84b-b5a005ed4f33" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compose_modelling_data(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>        eurostat_datasets,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        scale<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        impute<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        nlb_window<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        months_window<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        quarters_window<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        annual_window<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        data_output_folder<span class="op">=</span>os.path.join(BASE_DIR, <span class="st">'plots'</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Construct and return a modelling DataFrame that integrates NLB's non-performing loan (NPL) data </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    with a collection of Eurostat macroeconomic datasets, assembled in a format suitable for </span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">    time series regression and forecasting tasks. This function offers flexible processing options, </span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">    including data standardization (scaling), missing-value imputation, inclusion of lagged feature </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">    variables at multiple frequencies (monthly, quarterly, annual), and intermediate caching of the </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">    resulting DataFrame to disk for efficient repeated usage.</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Main workflow:</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">        - Loads the NLB NPL time series, aligning it with its calendar dates for use as both target and lagged features.</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">        - Accepts a set of Eurostat datasets (already harmonized to similar frequencies), each of which may be processed into a feature set with time-aligned observations.</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">        - Optionally produces lagged input features for the NPL time series as predictors (e.g., last nlb_window quarters), as well as lagged features of the Eurostat datasets at varying window sizes for each frequency: months, quarters, and years.</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">        - Supports missing-value imputation using pandas' fill-forward/backward mechanisms, if enabled.</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">        - Standardizes input features (and optionally the target/lagged target) to zero mean and unit variance if `scale` is True.</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">        - If an output version of the assembled dataset (with current settings) is already saved to disk as a CSV, loads and returns it for efficiency; otherwise, computes anew and saves the resulting DataFrame.</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">        - Produces a final DataFrame indexed by date, with columns for the NPL target variable and all feature columns, harmonized for downstream modelling.</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">    eurostat_datasets : dict</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Mapping from Eurostat variable names (str) to dataset dictionaries as returned by </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">        standardization/processing pipeline.</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co">    scale : bool, default True</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">        If True, standardize all time series variables (zero mean, unit variance).</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">    impute : bool, default True</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co">        If True, fill missing values using forward/backward-fill; if False, leave NaNs where present.</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">    nlb_window : int, default 2</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of previous quarters of NPL data to include as lagged features.</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co">    months_window : int, default 9</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of previous months for which to add lagged Eurostat features.</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co">    quarters_window : int, default 3</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of previous quarters for which to add lagged Eurostat features.</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">    annual_window : int, default 1</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of previous years for which to add lagged Eurostat features.</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">    nlb_npl_data_path : str</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to Excel file containing the original NLB NPL data.</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">    data_output_folder : str</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">        Output folder for storing/reading cached modelling DataFrames.</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">        A DataFrame where each row corresponds to a specific point in time (indexed by date, typically by quarter),</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">        and each column represents a variable used in the modelling task. The columns include:</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'npl': The target variable, i.e., the observed value of NLB's non-performing loans at each date.</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'npl-1q', 'npl-2q', ...: Lagged values of the NPL series, with each column representing the NPL value from a previous quarter (up to `nlb_window` lags).</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">            - '[Eurostat series name]-[lag][unit]': Lagged features from Eurostat datasets, where each column corresponds to a particular macroeconomic indicator, shifted backward by a certain lag (with the unit 'm' for months, 'q' for quarters, or 'y' for years, and the lag amount varies according to the settings for months_window, quarters_window, and annual_window).</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co">            - Additional columns result from all constructed lagged features for the given macroeconomic datasets and lag windows.</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Each row contains all feature values (and possibly standardized/scaled and/or imputed versions, depending on function arguments) for the same date, aligned for supervised modelling.</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the output folder exists</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_output_folder):</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>        os.makedirs(data_output_folder)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select output file name depending on scale/impute settings</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scale:</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> impute:</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>            data_output_name <span class="op">=</span> (</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'data_nlb_window_</span><span class="sc">{</span>nlb_window<span class="sc">}</span><span class="ss">_months_window_</span><span class="sc">{</span>months_window<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'_quarters_window_</span><span class="sc">{</span>quarters_window<span class="sc">}</span><span class="ss">_annual_window_</span><span class="sc">{</span>annual_window<span class="sc">}</span><span class="ss">_scaled_imputed.csv'</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>            data_output_name <span class="op">=</span> (</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'data_nlb_window_</span><span class="sc">{</span>nlb_window<span class="sc">}</span><span class="ss">_months_window_</span><span class="sc">{</span>months_window<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'_quarters_window_</span><span class="sc">{</span>quarters_window<span class="sc">}</span><span class="ss">_annual_window_</span><span class="sc">{</span>annual_window<span class="sc">}</span><span class="ss">_scaled.csv'</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> impute:</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>            data_output_name <span class="op">=</span> (</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'data_nlb_window_</span><span class="sc">{</span>nlb_window<span class="sc">}</span><span class="ss">_months_window_</span><span class="sc">{</span>months_window<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'_quarters_window_</span><span class="sc">{</span>quarters_window<span class="sc">}</span><span class="ss">_annual_window_</span><span class="sc">{</span>annual_window<span class="sc">}</span><span class="ss">_imputed.csv'</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>            data_output_name <span class="op">=</span> (</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'data_nlb_window_</span><span class="sc">{</span>nlb_window<span class="sc">}</span><span class="ss">_months_window_</span><span class="sc">{</span>months_window<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'_quarters_window_</span><span class="sc">{</span>quarters_window<span class="sc">}</span><span class="ss">_annual_window_</span><span class="sc">{</span>annual_window<span class="sc">}</span><span class="ss">.csv'</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    data_output_path <span class="op">=</span> os.path.join(data_output_folder, data_output_name)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the data is already saved, just load and return it</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(data_output_path):</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.read_csv(data_output_path, index_col<span class="op">=</span><span class="st">'date'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Read and initialize NLB NPL data ---</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        nlb_dates, nlb_npl_values <span class="op">=</span> load_nlb_npl_data()</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize DataFrame with index as nlb_dates</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>nlb_dates)</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'npl'</span>] <span class="op">=</span> nlb_npl_values</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Optionally construct lagged NPL features (by quarter, for nlb_window lag length)</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nlb_window <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, nlb_window <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>                data[<span class="ss">f'npl-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">q'</span>] <span class="op">=</span> data[<span class="st">'npl'</span>].shift(i)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Forward/backward-fill NPL lags if imputation is requested</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> impute:</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>            lag_cols <span class="op">=</span> [<span class="ss">f'npl-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">q'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, nlb_window <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>            data[lag_cols] <span class="op">=</span> data[lag_cols].ffill().bfill()</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Add Eurostat datasets as covariates (with appropriate history windows) ---</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>        dataset_names <span class="op">=</span> eurostat_datasets.keys()</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> dataset_name <span class="kw">in</span> dataset_names:</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>            dataset_data <span class="op">=</span> eurostat_datasets[dataset_name]</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>            dataset_times <span class="op">=</span> dataset_data[<span class="st">'times'</span>]</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Choose scaled or raw Eurostat values</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> scale:</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>                dataset_values <span class="op">=</span> dataset_data[<span class="st">'scaled_values'</span>]</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>                dataset_values <span class="op">=</span> dataset_data[<span class="st">'values'</span>]</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine the time unit for the current dataset (yearly, quarterly, or monthly)</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>            times_unit <span class="op">=</span> get_eurostat_time_unit(dataset_times[<span class="dv">0</span>])</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Select the rolling window based on the time unit</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> times_unit <span class="op">==</span> <span class="st">'y'</span>:</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>                time_window <span class="op">=</span> annual_window</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> times_unit <span class="op">==</span> <span class="st">'q'</span>:</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>                time_window <span class="op">=</span> quarters_window</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> times_unit <span class="op">==</span> <span class="st">'m'</span>:</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>                time_window <span class="op">=</span> months_window</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unrecognized Eurostat time unit: '</span><span class="sc">{</span>times_unit<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create lag columns for this dataset, for window size (0 latest to N lags back)</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(time_window <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>                colname <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>i<span class="sc">}{</span>times_unit<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>                data[colname] <span class="op">=</span> np.nan  <span class="co"># initialize with NaN</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>                <span class="co"># For each NLB date, attempt to match with a corresponding Eurostat date at lag -i</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> nlb_date <span class="kw">in</span> nlb_dates:</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> dataset_time <span class="kw">in</span> dataset_times:</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># compute_time_distance returns negative for the past</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> compute_time_distance(nlb_date, dataset_time) <span class="op">==</span> <span class="op">-</span>i:</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Uncomment next line for trace debugging</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># print(f'time distance: {i}, nlb_date: {nlb_date}, dataset_time: {dataset_time}')</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>                            data.loc[nlb_date, colname] <span class="op">=</span> dataset_values[dataset_times.index(dataset_time)]</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>            <span class="co"># --- Imputation logic for missing Eurostat data ---</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> impute:</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dataset_name <span class="op">==</span> <span class="st">'Unemployment Rate'</span>:</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># For 'Unemployment Rate', do special linear extrapolation (backwards)</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(time_window <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>                        col <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>i<span class="sc">}{</span>times_unit<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Avoid going out of bounds with j+1 and j+2 (iterate until 2 from bottom)</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">-</span> <span class="dv">2</span>):</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># If current is nan and next is not nan, try to extrapolate</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> pd.isna(data.iloc[j][col]) <span class="kw">and</span> <span class="kw">not</span> pd.isna(data.iloc[j <span class="op">+</span> <span class="dv">1</span>][col]):</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>                                start_value <span class="op">=</span> data.iloc[j <span class="op">+</span> <span class="dv">1</span>][col]</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>                                next_value <span class="op">=</span> data.iloc[j <span class="op">+</span> <span class="dv">2</span>][col]</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># If next value is nan too, can't do linear extrapolation</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> pd.isna(next_value):</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">continue</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># The difference (slope) for backwards linear fill</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>                                delta <span class="op">=</span> start_value <span class="op">-</span> next_value</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># Fill all consecutive nans back as a line</span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(j, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> pd.isna(data.iloc[k][col]):</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># The further back, the further from start_value by slope times (j+1-k)</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>                                        data.iloc[k, data.columns.get_loc(col)] <span class="op">=</span> start_value <span class="op">+</span> delta <span class="op">*</span> (j <span class="op">+</span> <span class="dv">1</span> <span class="op">-</span> k)</span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">else</span>:</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Stop when hit a non-nan value further back</span></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">break</span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># For all other datasets, fill forward then backward using nearest values</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(time_window <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>                        col <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>dataset_name<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>i<span class="sc">}{</span>times_unit<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> col <span class="kw">in</span> data.columns:</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>                            data[col] <span class="op">=</span> data[col].ffill().bfill()</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Uncomment next line to save data to disk if needed</span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>        <span class="co"># data.to_csv(data_output_path, index_label='date')</span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>nlb_window <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>months_window <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>quarters_window <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>annual_window <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> compose_modelling_data(eurostat_datasets, scale<span class="op">=</span><span class="va">True</span>, impute<span class="op">=</span><span class="va">True</span>, nlb_window <span class="op">=</span> nlb_window, months_window<span class="op">=</span>months_window, quarters_window<span class="op">=</span>quarters_window, annual_window<span class="op">=</span>annual_window)</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>head_df, styled <span class="op">=</span> plot_df_head_table(data, n<span class="op">=</span><span class="dv">8</span>, caption<span class="op">=</span><span class="st">"Training data (head)"</span>, precision<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>styled </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<style type="text/css">
#T_1e24e caption {
  caption-side: top;
  font-size: 1.05rem;
  font-weight: 600;
  padding: 0 0 8px 0;
}
#T_1e24e table {
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  border: 1px solid #e6e6e6;
  border-radius: 12px;
  overflow: hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
}
#T_1e24e thead th {
  border-bottom: 1px solid #e6e6e6;
  padding: 10px 12px;
  text-align: center;
  font-weight: 600;
}
#T_1e24e th.row_heading {
  border-right: 1px solid #e6e6e6;
  font-weight: 600;
  padding: 10px 12px;
  text-align: left;
}
#T_1e24e tbody td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid #f0f0f0;
}
#T_1e24e tbody tr:hover {
  background: #fcfcfc;
}
#T_1e24e_row0_col0, #T_1e24e_row0_col1, #T_1e24e_row0_col2, #T_1e24e_row0_col3, #T_1e24e_row0_col4, #T_1e24e_row0_col5, #T_1e24e_row0_col6, #T_1e24e_row0_col7, #T_1e24e_row0_col8, #T_1e24e_row0_col9, #T_1e24e_row0_col10, #T_1e24e_row0_col11, #T_1e24e_row0_col12, #T_1e24e_row0_col13, #T_1e24e_row0_col14, #T_1e24e_row0_col15, #T_1e24e_row0_col16, #T_1e24e_row0_col17, #T_1e24e_row0_col18, #T_1e24e_row0_col19, #T_1e24e_row0_col20, #T_1e24e_row0_col21, #T_1e24e_row0_col22, #T_1e24e_row0_col23, #T_1e24e_row1_col0, #T_1e24e_row1_col1, #T_1e24e_row1_col2, #T_1e24e_row1_col3, #T_1e24e_row1_col4, #T_1e24e_row1_col5, #T_1e24e_row1_col6, #T_1e24e_row1_col7, #T_1e24e_row1_col8, #T_1e24e_row1_col9, #T_1e24e_row1_col10, #T_1e24e_row1_col11, #T_1e24e_row1_col12, #T_1e24e_row1_col13, #T_1e24e_row1_col14, #T_1e24e_row1_col15, #T_1e24e_row1_col16, #T_1e24e_row1_col17, #T_1e24e_row1_col18, #T_1e24e_row1_col19, #T_1e24e_row1_col20, #T_1e24e_row1_col21, #T_1e24e_row1_col22, #T_1e24e_row1_col23, #T_1e24e_row2_col0, #T_1e24e_row2_col1, #T_1e24e_row2_col2, #T_1e24e_row2_col3, #T_1e24e_row2_col4, #T_1e24e_row2_col5, #T_1e24e_row2_col6, #T_1e24e_row2_col7, #T_1e24e_row2_col8, #T_1e24e_row2_col9, #T_1e24e_row2_col10, #T_1e24e_row2_col11, #T_1e24e_row2_col12, #T_1e24e_row2_col13, #T_1e24e_row2_col14, #T_1e24e_row2_col15, #T_1e24e_row2_col16, #T_1e24e_row2_col17, #T_1e24e_row2_col18, #T_1e24e_row2_col19, #T_1e24e_row2_col20, #T_1e24e_row2_col21, #T_1e24e_row2_col22, #T_1e24e_row2_col23, #T_1e24e_row3_col0, #T_1e24e_row3_col1, #T_1e24e_row3_col2, #T_1e24e_row3_col3, #T_1e24e_row3_col4, #T_1e24e_row3_col5, #T_1e24e_row3_col6, #T_1e24e_row3_col7, #T_1e24e_row3_col8, #T_1e24e_row3_col9, #T_1e24e_row3_col10, #T_1e24e_row3_col11, #T_1e24e_row3_col12, #T_1e24e_row3_col13, #T_1e24e_row3_col14, #T_1e24e_row3_col15, #T_1e24e_row3_col16, #T_1e24e_row3_col17, #T_1e24e_row3_col18, #T_1e24e_row3_col19, #T_1e24e_row3_col20, #T_1e24e_row3_col21, #T_1e24e_row3_col22, #T_1e24e_row3_col23, #T_1e24e_row4_col0, #T_1e24e_row4_col1, #T_1e24e_row4_col2, #T_1e24e_row4_col3, #T_1e24e_row4_col4, #T_1e24e_row4_col5, #T_1e24e_row4_col6, #T_1e24e_row4_col7, #T_1e24e_row4_col8, #T_1e24e_row4_col9, #T_1e24e_row4_col10, #T_1e24e_row4_col11, #T_1e24e_row4_col12, #T_1e24e_row4_col13, #T_1e24e_row4_col14, #T_1e24e_row4_col15, #T_1e24e_row4_col16, #T_1e24e_row4_col17, #T_1e24e_row4_col18, #T_1e24e_row4_col19, #T_1e24e_row4_col20, #T_1e24e_row4_col21, #T_1e24e_row4_col22, #T_1e24e_row4_col23, #T_1e24e_row5_col0, #T_1e24e_row5_col1, #T_1e24e_row5_col2, #T_1e24e_row5_col3, #T_1e24e_row5_col4, #T_1e24e_row5_col5, #T_1e24e_row5_col6, #T_1e24e_row5_col7, #T_1e24e_row5_col8, #T_1e24e_row5_col9, #T_1e24e_row5_col10, #T_1e24e_row5_col11, #T_1e24e_row5_col12, #T_1e24e_row5_col13, #T_1e24e_row5_col14, #T_1e24e_row5_col15, #T_1e24e_row5_col16, #T_1e24e_row5_col17, #T_1e24e_row5_col18, #T_1e24e_row5_col19, #T_1e24e_row5_col20, #T_1e24e_row5_col21, #T_1e24e_row5_col22, #T_1e24e_row5_col23, #T_1e24e_row6_col0, #T_1e24e_row6_col1, #T_1e24e_row6_col2, #T_1e24e_row6_col3, #T_1e24e_row6_col4, #T_1e24e_row6_col5, #T_1e24e_row6_col6, #T_1e24e_row6_col7, #T_1e24e_row6_col8, #T_1e24e_row6_col9, #T_1e24e_row6_col10, #T_1e24e_row6_col11, #T_1e24e_row6_col12, #T_1e24e_row6_col13, #T_1e24e_row6_col14, #T_1e24e_row6_col15, #T_1e24e_row6_col16, #T_1e24e_row6_col17, #T_1e24e_row6_col18, #T_1e24e_row6_col19, #T_1e24e_row6_col20, #T_1e24e_row6_col21, #T_1e24e_row6_col22, #T_1e24e_row6_col23, #T_1e24e_row7_col0, #T_1e24e_row7_col1, #T_1e24e_row7_col2, #T_1e24e_row7_col3, #T_1e24e_row7_col4, #T_1e24e_row7_col5, #T_1e24e_row7_col6, #T_1e24e_row7_col7, #T_1e24e_row7_col8, #T_1e24e_row7_col9, #T_1e24e_row7_col10, #T_1e24e_row7_col11, #T_1e24e_row7_col12, #T_1e24e_row7_col13, #T_1e24e_row7_col14, #T_1e24e_row7_col15, #T_1e24e_row7_col16, #T_1e24e_row7_col17, #T_1e24e_row7_col18, #T_1e24e_row7_col19, #T_1e24e_row7_col20, #T_1e24e_row7_col21, #T_1e24e_row7_col22, #T_1e24e_row7_col23 {
  min-width: 80px;
}
</style>

<div id="T_1e24e" class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_1e24e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Training data (head)
</figcaption>
<div aria-describedby="T_1e24e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="T_1e24e" class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_1e24e_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">npl</th>
<th id="T_1e24e_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">npl-1q</th>
<th id="T_1e24e_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">npl-2q</th>
<th id="T_1e24e_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Gross domestic product (GDP) (2015 = 100)-0y</th>
<th id="T_1e24e_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Gross domestic product (GDP) (2015 = 100)-1y</th>
<th id="T_1e24e_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">Gross domestic product (GDP) (percentage change on previous)-0y</th>
<th id="T_1e24e_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">Gross domestic product (GDP) (percentage change on previous)-1y</th>
<th id="T_1e24e_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">Unemployment Rate-0q</th>
<th id="T_1e24e_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">Unemployment Rate-1q</th>
<th id="T_1e24e_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">Unemployment Rate-2q</th>
<th id="T_1e24e_level0_col10" class="col_heading level0 col10" data-quarto-table-cell-role="th">House price index (2015 = 100)-0q</th>
<th id="T_1e24e_level0_col11" class="col_heading level0 col11" data-quarto-table-cell-role="th">House price index (2015 = 100)-1q</th>
<th id="T_1e24e_level0_col12" class="col_heading level0 col12" data-quarto-table-cell-role="th">House price index (2015 = 100)-2q</th>
<th id="T_1e24e_level0_col13" class="col_heading level0 col13" data-quarto-table-cell-role="th">Harmonised Index of Consumer Prices (annual rate of change)-0q</th>
<th id="T_1e24e_level0_col14" class="col_heading level0 col14" data-quarto-table-cell-role="th">Harmonised Index of Consumer Prices (annual rate of change)-1q</th>
<th id="T_1e24e_level0_col15" class="col_heading level0 col15" data-quarto-table-cell-role="th">Harmonised Index of Consumer Prices (annual rate of change)-2q</th>
<th id="T_1e24e_level0_col16" class="col_heading level0 col16" data-quarto-table-cell-role="th">Private sectror credit flow-0y</th>
<th id="T_1e24e_level0_col17" class="col_heading level0 col17" data-quarto-table-cell-role="th">Private sectror credit flow-1y</th>
<th id="T_1e24e_level0_col18" class="col_heading level0 col18" data-quarto-table-cell-role="th">Money Market Interest Rate-0q</th>
<th id="T_1e24e_level0_col19" class="col_heading level0 col19" data-quarto-table-cell-role="th">Money Market Interest Rate-1q</th>
<th id="T_1e24e_level0_col20" class="col_heading level0 col20" data-quarto-table-cell-role="th">Money Market Interest Rate-2q</th>
<th id="T_1e24e_level0_col21" class="col_heading level0 col21" data-quarto-table-cell-role="th">Consumer confidence indicator-0q</th>
<th id="T_1e24e_level0_col22" class="col_heading level0 col22" data-quarto-table-cell-role="th">Consumer confidence indicator-1q</th>
<th id="T_1e24e_level0_col23" class="col_heading level0 col23" data-quarto-table-cell-role="th">Consumer confidence indicator-2q</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_1e24e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">2008-03-31 00:00:00</th>
<td id="T_1e24e_row0_col0" class="data row0 col0">0.052</td>
<td id="T_1e24e_row0_col1" class="data row0 col1">0.052</td>
<td id="T_1e24e_row0_col2" class="data row0 col2">0.052</td>
<td id="T_1e24e_row0_col3" class="data row0 col3">-0.122</td>
<td id="T_1e24e_row0_col4" class="data row0 col4">-0.447</td>
<td id="T_1e24e_row0_col5" class="data row0 col5">0.340</td>
<td id="T_1e24e_row0_col6" class="data row0 col6">1.298</td>
<td id="T_1e24e_row0_col7" class="data row0 col7">-1.345</td>
<td id="T_1e24e_row0_col8" class="data row0 col8">-1.525</td>
<td id="T_1e24e_row0_col9" class="data row0 col9">-1.705</td>
<td id="T_1e24e_row0_col10" class="data row0 col10">0.155</td>
<td id="T_1e24e_row0_col11" class="data row0 col11">0.080</td>
<td id="T_1e24e_row0_col12" class="data row0 col12">-0.148</td>
<td id="T_1e24e_row0_col13" class="data row0 col13">1.461</td>
<td id="T_1e24e_row0_col14" class="data row0 col14">1.128</td>
<td id="T_1e24e_row0_col15" class="data row0 col15">0.451</td>
<td id="T_1e24e_row0_col16" class="data row0 col16">1.830</td>
<td id="T_1e24e_row0_col17" class="data row0 col17">2.684</td>
<td id="T_1e24e_row0_col18" class="data row0 col18">1.892</td>
<td id="T_1e24e_row0_col19" class="data row0 col19">2.009</td>
<td id="T_1e24e_row0_col20" class="data row0 col20">1.969</td>
<td id="T_1e24e_row0_col21" class="data row0 col21">-0.387</td>
<td id="T_1e24e_row0_col22" class="data row0 col22">-0.015</td>
<td id="T_1e24e_row0_col23" class="data row0 col23">0.786</td>
</tr>
<tr class="even">
<th id="T_1e24e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">2008-06-30 00:00:00</th>
<td id="T_1e24e_row1_col0" class="data row1 col0">0.042</td>
<td id="T_1e24e_row1_col1" class="data row1 col1">0.052</td>
<td id="T_1e24e_row1_col2" class="data row1 col2">0.052</td>
<td id="T_1e24e_row1_col3" class="data row1 col3">-0.122</td>
<td id="T_1e24e_row1_col4" class="data row1 col4">-0.447</td>
<td id="T_1e24e_row1_col5" class="data row1 col5">0.340</td>
<td id="T_1e24e_row1_col6" class="data row1 col6">1.298</td>
<td id="T_1e24e_row1_col7" class="data row1 col7">-1.165</td>
<td id="T_1e24e_row1_col8" class="data row1 col8">-1.345</td>
<td id="T_1e24e_row1_col9" class="data row1 col9">-1.525</td>
<td id="T_1e24e_row1_col10" class="data row1 col10">0.145</td>
<td id="T_1e24e_row1_col11" class="data row1 col11">0.155</td>
<td id="T_1e24e_row1_col12" class="data row1 col12">0.080</td>
<td id="T_1e24e_row1_col13" class="data row1 col13">1.448</td>
<td id="T_1e24e_row1_col14" class="data row1 col14">1.461</td>
<td id="T_1e24e_row1_col15" class="data row1 col15">1.128</td>
<td id="T_1e24e_row1_col16" class="data row1 col16">1.830</td>
<td id="T_1e24e_row1_col17" class="data row1 col17">2.684</td>
<td id="T_1e24e_row1_col18" class="data row1 col18">2.337</td>
<td id="T_1e24e_row1_col19" class="data row1 col19">1.892</td>
<td id="T_1e24e_row1_col20" class="data row1 col20">2.009</td>
<td id="T_1e24e_row1_col21" class="data row1 col21">-0.294</td>
<td id="T_1e24e_row1_col22" class="data row1 col22">-0.387</td>
<td id="T_1e24e_row1_col23" class="data row1 col23">-0.015</td>
</tr>
<tr class="odd">
<th id="T_1e24e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2008-09-30 00:00:00</th>
<td id="T_1e24e_row2_col0" class="data row2 col0">0.051</td>
<td id="T_1e24e_row2_col1" class="data row2 col1">0.042</td>
<td id="T_1e24e_row2_col2" class="data row2 col2">0.052</td>
<td id="T_1e24e_row2_col3" class="data row2 col3">-0.122</td>
<td id="T_1e24e_row2_col4" class="data row2 col4">-0.447</td>
<td id="T_1e24e_row2_col5" class="data row2 col5">0.340</td>
<td id="T_1e24e_row2_col6" class="data row2 col6">1.298</td>
<td id="T_1e24e_row2_col7" class="data row2 col7">-0.985</td>
<td id="T_1e24e_row2_col8" class="data row2 col8">-1.165</td>
<td id="T_1e24e_row2_col9" class="data row2 col9">-1.345</td>
<td id="T_1e24e_row2_col10" class="data row2 col10">0.247</td>
<td id="T_1e24e_row2_col11" class="data row2 col11">0.145</td>
<td id="T_1e24e_row2_col12" class="data row2 col12">0.155</td>
<td id="T_1e24e_row2_col13" class="data row2 col13">1.350</td>
<td id="T_1e24e_row2_col14" class="data row2 col14">1.448</td>
<td id="T_1e24e_row2_col15" class="data row2 col15">1.461</td>
<td id="T_1e24e_row2_col16" class="data row2 col16">1.830</td>
<td id="T_1e24e_row2_col17" class="data row2 col17">2.684</td>
<td id="T_1e24e_row2_col18" class="data row2 col18">2.351</td>
<td id="T_1e24e_row2_col19" class="data row2 col19">2.337</td>
<td id="T_1e24e_row2_col20" class="data row2 col20">1.892</td>
<td id="T_1e24e_row2_col21" class="data row2 col21">-0.201</td>
<td id="T_1e24e_row2_col22" class="data row2 col22">-0.294</td>
<td id="T_1e24e_row2_col23" class="data row2 col23">-0.387</td>
</tr>
<tr class="even">
<th id="T_1e24e_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">2008-12-31 00:00:00</th>
<td id="T_1e24e_row3_col0" class="data row3 col0">0.051</td>
<td id="T_1e24e_row3_col1" class="data row3 col1">0.051</td>
<td id="T_1e24e_row3_col2" class="data row3 col2">0.042</td>
<td id="T_1e24e_row3_col3" class="data row3 col3">-0.122</td>
<td id="T_1e24e_row3_col4" class="data row3 col4">-0.447</td>
<td id="T_1e24e_row3_col5" class="data row3 col5">0.340</td>
<td id="T_1e24e_row3_col6" class="data row3 col6">1.298</td>
<td id="T_1e24e_row3_col7" class="data row3 col7">-0.806</td>
<td id="T_1e24e_row3_col8" class="data row3 col8">-0.985</td>
<td id="T_1e24e_row3_col9" class="data row3 col9">-1.165</td>
<td id="T_1e24e_row3_col10" class="data row3 col10">0.071</td>
<td id="T_1e24e_row3_col11" class="data row3 col11">0.247</td>
<td id="T_1e24e_row3_col12" class="data row3 col12">0.145</td>
<td id="T_1e24e_row3_col13" class="data row3 col13">0.254</td>
<td id="T_1e24e_row3_col14" class="data row3 col14">1.350</td>
<td id="T_1e24e_row3_col15" class="data row3 col15">1.448</td>
<td id="T_1e24e_row3_col16" class="data row3 col16">1.830</td>
<td id="T_1e24e_row3_col17" class="data row3 col17">2.684</td>
<td id="T_1e24e_row3_col18" class="data row3 col18">1.234</td>
<td id="T_1e24e_row3_col19" class="data row3 col19">2.351</td>
<td id="T_1e24e_row3_col20" class="data row3 col20">2.337</td>
<td id="T_1e24e_row3_col21" class="data row3 col21">-0.722</td>
<td id="T_1e24e_row3_col22" class="data row3 col22">-0.201</td>
<td id="T_1e24e_row3_col23" class="data row3 col23">-0.294</td>
</tr>
<tr class="odd">
<th id="T_1e24e_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">2009-03-31 00:00:00</th>
<td id="T_1e24e_row4_col0" class="data row4 col0">0.058</td>
<td id="T_1e24e_row4_col1" class="data row4 col1">0.051</td>
<td id="T_1e24e_row4_col2" class="data row4 col2">0.051</td>
<td id="T_1e24e_row4_col3" class="data row4 col3">-0.879</td>
<td id="T_1e24e_row4_col4" class="data row4 col4">-0.122</td>
<td id="T_1e24e_row4_col5" class="data row4 col5">-2.509</td>
<td id="T_1e24e_row4_col6" class="data row4 col6">0.340</td>
<td id="T_1e24e_row4_col7" class="data row4 col7">-0.626</td>
<td id="T_1e24e_row4_col8" class="data row4 col8">-0.806</td>
<td id="T_1e24e_row4_col9" class="data row4 col9">-0.985</td>
<td id="T_1e24e_row4_col10" class="data row4 col10">-0.261</td>
<td id="T_1e24e_row4_col11" class="data row4 col11">0.071</td>
<td id="T_1e24e_row4_col12" class="data row4 col12">0.247</td>
<td id="T_1e24e_row4_col13" class="data row4 col13">-0.288</td>
<td id="T_1e24e_row4_col14" class="data row4 col14">0.254</td>
<td id="T_1e24e_row4_col15" class="data row4 col15">1.350</td>
<td id="T_1e24e_row4_col16" class="data row4 col16">0.023</td>
<td id="T_1e24e_row4_col17" class="data row4 col17">1.830</td>
<td id="T_1e24e_row4_col18" class="data row4 col18">0.342</td>
<td id="T_1e24e_row4_col19" class="data row4 col19">1.234</td>
<td id="T_1e24e_row4_col20" class="data row4 col20">2.351</td>
<td id="T_1e24e_row4_col21" class="data row4 col21">-1.150</td>
<td id="T_1e24e_row4_col22" class="data row4 col22">-0.722</td>
<td id="T_1e24e_row4_col23" class="data row4 col23">-0.201</td>
</tr>
<tr class="even">
<th id="T_1e24e_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">2009-06-30 00:00:00</th>
<td id="T_1e24e_row5_col0" class="data row5 col0">0.047</td>
<td id="T_1e24e_row5_col1" class="data row5 col1">0.058</td>
<td id="T_1e24e_row5_col2" class="data row5 col2">0.051</td>
<td id="T_1e24e_row5_col3" class="data row5 col3">-0.879</td>
<td id="T_1e24e_row5_col4" class="data row5 col4">-0.122</td>
<td id="T_1e24e_row5_col5" class="data row5 col5">-2.509</td>
<td id="T_1e24e_row5_col6" class="data row5 col6">0.340</td>
<td id="T_1e24e_row5_col7" class="data row5 col7">-0.446</td>
<td id="T_1e24e_row5_col8" class="data row5 col8">-0.626</td>
<td id="T_1e24e_row5_col9" class="data row5 col9">-0.806</td>
<td id="T_1e24e_row5_col10" class="data row5 col10">-0.363</td>
<td id="T_1e24e_row5_col11" class="data row5 col11">-0.261</td>
<td id="T_1e24e_row5_col12" class="data row5 col12">0.071</td>
<td id="T_1e24e_row5_col13" class="data row5 col13">-0.694</td>
<td id="T_1e24e_row5_col14" class="data row5 col14">-0.288</td>
<td id="T_1e24e_row5_col15" class="data row5 col15">0.254</td>
<td id="T_1e24e_row5_col16" class="data row5 col16">0.023</td>
<td id="T_1e24e_row5_col17" class="data row5 col17">1.830</td>
<td id="T_1e24e_row5_col18" class="data row5 col18">0.169</td>
<td id="T_1e24e_row5_col19" class="data row5 col19">0.342</td>
<td id="T_1e24e_row5_col20" class="data row5 col20">1.234</td>
<td id="T_1e24e_row5_col21" class="data row5 col21">-0.898</td>
<td id="T_1e24e_row5_col22" class="data row5 col22">-1.150</td>
<td id="T_1e24e_row5_col23" class="data row5 col23">-0.722</td>
</tr>
<tr class="odd">
<th id="T_1e24e_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">2009-09-30 00:00:00</th>
<td id="T_1e24e_row6_col0" class="data row6 col0">0.057</td>
<td id="T_1e24e_row6_col1" class="data row6 col1">0.047</td>
<td id="T_1e24e_row6_col2" class="data row6 col2">0.058</td>
<td id="T_1e24e_row6_col3" class="data row6 col3">-0.879</td>
<td id="T_1e24e_row6_col4" class="data row6 col4">-0.122</td>
<td id="T_1e24e_row6_col5" class="data row6 col5">-2.509</td>
<td id="T_1e24e_row6_col6" class="data row6 col6">0.340</td>
<td id="T_1e24e_row6_col7" class="data row6 col7">-0.266</td>
<td id="T_1e24e_row6_col8" class="data row6 col8">-0.446</td>
<td id="T_1e24e_row6_col9" class="data row6 col9">-0.626</td>
<td id="T_1e24e_row6_col10" class="data row6 col10">-0.446</td>
<td id="T_1e24e_row6_col11" class="data row6 col11">-0.363</td>
<td id="T_1e24e_row6_col12" class="data row6 col12">-0.261</td>
<td id="T_1e24e_row6_col13" class="data row6 col13">-0.978</td>
<td id="T_1e24e_row6_col14" class="data row6 col14">-0.694</td>
<td id="T_1e24e_row6_col15" class="data row6 col15">-0.288</td>
<td id="T_1e24e_row6_col16" class="data row6 col16">0.023</td>
<td id="T_1e24e_row6_col17" class="data row6 col17">1.830</td>
<td id="T_1e24e_row6_col18" class="data row6 col18">-0.033</td>
<td id="T_1e24e_row6_col19" class="data row6 col19">0.169</td>
<td id="T_1e24e_row6_col20" class="data row6 col20">0.342</td>
<td id="T_1e24e_row6_col21" class="data row6 col21">-0.215</td>
<td id="T_1e24e_row6_col22" class="data row6 col22">-0.898</td>
<td id="T_1e24e_row6_col23" class="data row6 col23">-1.150</td>
</tr>
<tr class="even">
<th id="T_1e24e_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">2009-12-31 00:00:00</th>
<td id="T_1e24e_row7_col0" class="data row7 col0">0.054</td>
<td id="T_1e24e_row7_col1" class="data row7 col1">0.057</td>
<td id="T_1e24e_row7_col2" class="data row7 col2">0.047</td>
<td id="T_1e24e_row7_col3" class="data row7 col3">-0.879</td>
<td id="T_1e24e_row7_col4" class="data row7 col4">-0.122</td>
<td id="T_1e24e_row7_col5" class="data row7 col5">-2.509</td>
<td id="T_1e24e_row7_col6" class="data row7 col6">0.340</td>
<td id="T_1e24e_row7_col7" class="data row7 col7">-0.176</td>
<td id="T_1e24e_row7_col8" class="data row7 col8">-0.266</td>
<td id="T_1e24e_row7_col9" class="data row7 col9">-0.446</td>
<td id="T_1e24e_row7_col10" class="data row7 col10">-0.361</td>
<td id="T_1e24e_row7_col11" class="data row7 col11">-0.446</td>
<td id="T_1e24e_row7_col12" class="data row7 col12">-0.363</td>
<td id="T_1e24e_row7_col13" class="data row7 col13">-0.424</td>
<td id="T_1e24e_row7_col14" class="data row7 col14">-0.978</td>
<td id="T_1e24e_row7_col15" class="data row7 col15">-0.694</td>
<td id="T_1e24e_row7_col16" class="data row7 col16">0.023</td>
<td id="T_1e24e_row7_col17" class="data row7 col17">1.830</td>
<td id="T_1e24e_row7_col18" class="data row7 col18">-0.043</td>
<td id="T_1e24e_row7_col19" class="data row7 col19">-0.033</td>
<td id="T_1e24e_row7_col20" class="data row7 col20">0.169</td>
<td id="T_1e24e_row7_col21" class="data row7 col21">-0.570</td>
<td id="T_1e24e_row7_col22" class="data row7 col22">-0.215</td>
<td id="T_1e24e_row7_col23" class="data row7 col23">-0.898</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
<p><strong>Table 1.</strong> First few rows of the collected data points for modelling - npl values and values of the variables within the time windows allowed my maximal delays. Recall that the values of the macroeconomic variables have been scaled to have zero mean and unit standard deviation for the stability of the model.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>The model achieves the mean square error (MSE) of 0.0001 and the <span class="math inline">\(R^2\)</span> score of 0.86 in the test set 1 reflecting solid reliability withing the modelling period. In the test set 2, measuring the future performance of the model, it achieves a much worse <span class="math inline">\(R^2\)</span> score of -66.58.</p>
<p>Figure 2 compares the model predictions with the ground truth values and the train data. Recall that the test data has been taken to be non-overlapping with the train data - the corresponding time stamps are not included in the train data. We see that the model captures correctly the different regimes in the NPL curve - higher values during the Euro crisis 2008-2012 and lower values afterwards. In the future prediction regime, the model captures really well the first next quarter value and stays relatively close to the second next value before it drops to zero for the third value. This indicates that the predictive power of the model is at most 2 quarters.</p>
<div id="b37681ff-5819-4395-8382-001c0dda2c8e" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_test_split(data, test_1_size<span class="op">=</span><span class="dv">6</span>, test_2_size<span class="op">=</span><span class="dv">6</span>, random_state<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Splits the data into three sets: training, test_1, and test_2.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    - test_2: The last `test_2_size` rows of the data (chronologically, for time series).</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    - test_1: Random `test_1_size` rows from the remaining data (not including test_2).</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    - train: The remaining data after removing both test splits.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    data : pandas.DataFrame</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">        The complete dataset to split. Should have a time-based index if time-split is desired.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">    test_1_size : int, optional</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of rows to sample randomly for the first test set.</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">    test_2_size : int, optional</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of final rows for the second test set (default 6).</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">    random_state : int, optional</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Random seed for reproducibility of the random sample.</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">    data_train : pandas.DataFrame</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">        The training data (with neither test_1 nor test_2 rows).</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">    data_test_1 : pandas.DataFrame</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Random sample from the remaining data (after taking off test_2).</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">    data_test_2 : pandas.DataFrame</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">        The last `test_2_size` rows of the input data.</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make a copy of the input data to avoid mutating the original dataframe</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    data_copy <span class="op">=</span> data.copy()</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The last `test_2_size` entries are reserved for the second test split (chronological holdout)</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    data_test_2 <span class="op">=</span> data_copy.tail(test_2_size)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove test_2 entries from the data copy to create a pool for training and test_1 split</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    data_remaining <span class="op">=</span> data_copy.iloc[:<span class="op">-</span>test_2_size]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly sample `test_1_size` rows from the remaining data to create the first test split</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    data_test_1 <span class="op">=</span> data_remaining.sample(n<span class="op">=</span>test_1_size, random_state<span class="op">=</span>random_state)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The rows not in the first or second test splits form the training data</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    data_train <span class="op">=</span> data_remaining.drop(data_test_1.index)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the three splits in order: training, test_1, test_2</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_train, data_test_1, data_test_2</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_linear_model_with_time_delay(data):</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co">    Fit a linear regression model to the data, using all columns except 'npl' as predictors</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co">    and 'npl' as the target variable.</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co">    data : pandas.DataFrame</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co">        DataFrame containing the feature columns and an 'npl' column as target.</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="co">    model : LinearRegression</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co">        Fitted linear regression model.</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> data[<span class="st">'npl'</span>]                    <span class="co"># Target variable</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> data.drop(columns<span class="op">=</span>[<span class="st">'npl'</span>])     <span class="co"># Predictor variables</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LinearRegression()         <span class="co"># Instantiate linear regression</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    model.fit(x, y)                    <span class="co"># Fit model to data</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model                       <span class="co"># Return trained model</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_linear_model(model, test_data):</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="co">    Evaluate a fitted linear regression model on test data.</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="co">    Predicts the 'npl' value, clips predictions at zero, and computes evaluation metrics.</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co">    model : LinearRegression</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="co">        Fitted sklearn linear regression model.</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co">    test_data : pandas.DataFrame</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="co">        DataFrame containing the features (same as train) and 'npl' column for ground truth.</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="co">    y_pred : numpy.ndarray</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="co">        Model predictions for 'npl', clipped at zero.</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="co">    mse : float</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="co">        Mean squared error of predictions vs ground truth.</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="co">    r2 : float</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="co">        R^2 score of predictions vs ground truth.</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> test_data[<span class="st">'npl'</span>]                  <span class="co"># Ground truth</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    x_test <span class="op">=</span> test_data.drop(columns<span class="op">=</span>[<span class="st">'npl'</span>])   <span class="co"># Test predictors</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict on test data</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(x_test)</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> np.maximum(y_pred, <span class="dv">0</span>)             <span class="co"># Clip predictions at zero (no negative NPL values)</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute evaluation metrics</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> mean_squared_error(y_true, y_pred)   <span class="co"># Mean squared error</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)              <span class="co"># R^2 score</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y_pred, mse, r2                     <span class="co"># Return predictions and metrics</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>data_train, data_test_1, data_test_2 <span class="op">=</span> train_test_split(data, test_1_size<span class="op">=</span><span class="dv">6</span>, test_2_size<span class="op">=</span><span class="dv">6</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> fit_linear_model_with_time_delay(data_train)</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>y_pred_test_1, mse_test_1, r2_test_1 <span class="op">=</span> evaluate_linear_model(model, data_test_1)</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>y_pred_test_2, mse_test_2, r2_test_2 <span class="op">=</span> evaluate_linear_model(model, data_test_2)</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>plot_npl_predictions(data_train, data_test_1, data_test_2, y_pred_test_1, mse_test_1, r2_test_1, y_pred_test_2, mse_test_2, r2_test_2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TimeSeriesModelling_files/figure-html/cell-5-output-1.png" width="1148" height="756" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 2.</strong> Comparison of the predictions of the linear model with delay with the ground truth values and the training data. Above: The model captures well the crisis and the post crisis regimes of the NPL, achieving solid performance metrics scores. Below: The model is only able to predict two quartals into the furure.</p>
<p>The modelâ€™s coefficients reveal the importance of different variables at different time spans for the model prediction. Table 2 lists all the model coefficients. Figure 3 shows the coefficients in a log-linear plot allowing us to observe the importance of variables. Gross domestic product, Unemployment Rate and House price index are found to be the most important macroeconomic variables influencing the NPL. We also find that the value of the NPL in the previous quartal is extremely important - if the bank is doing well, that will typically not change overnight and vice versa, a nonstable situation can usually not be improved very rapidly. The exception are of course extreme macroeconomic events like crises and recoveries.</p>
<div id="fd370bcf-3df2-40f1-83aa-8e408bdd4e31" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_coef, styled <span class="op">=</span> plot_model_coefficients_table(model, data, target<span class="op">=</span><span class="st">"npl"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>styled  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="29">
<style type="text/css">
#T_6ebc4 caption {
  caption-side: top;
  font-size: 1.05rem;
  font-weight: 600;
  padding: 0 0 8px 0;
}
#T_6ebc4 table {
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  border: 1px solid #e6e6e6;
  border-radius: 12px;
  overflow: hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
}
#T_6ebc4 thead th {
  background: #fafafa;
  border-bottom: 1px solid #e6e6e6;
  padding: 10px 12px;
  text-align: center;
  font-weight: 600;
}
#T_6ebc4 th.row_heading {
  background: #fafafa;
  border-right: 1px solid #e6e6e6;
  font-weight: 600;
  padding: 10px 12px;
  text-align: left;
}
#T_6ebc4 tbody td {
  padding: 10px 12px;
  text-align: right;
  border-bottom: 1px solid #f0f0f0;
}
#T_6ebc4 tbody tr:hover {
  background: #fcfcfc;
}
#T_6ebc4_row0_col0 {
  min-width: 80px;
  background-color: #4575b4;
  color: #f1f1f1;
}
#T_6ebc4_row0_col1 {
  min-width: 80px;
  background-color: #fae4e3;
  color: #000000;
}
#T_6ebc4_row0_col2 {
  min-width: 80px;
  background-color: #f6d2d0;
  color: #000000;
}
#T_6ebc4_row0_col3 {
  min-width: 80px;
  background-color: #e0e8f2;
  color: #000000;
}
#T_6ebc4_row0_col4 {
  min-width: 80px;
  background-color: #f0f4f9;
  color: #000000;
}
#T_6ebc4_row0_col5, #T_6ebc4_row0_col22 {
  min-width: 80px;
  background-color: #fffefe;
  color: #000000;
}
#T_6ebc4_row0_col6, #T_6ebc4_row0_col14, #T_6ebc4_row0_col16 {
  min-width: 80px;
  background-color: #fbfcfe;
  color: #000000;
}
#T_6ebc4_row0_col7 {
  min-width: 80px;
  background-color: #fef8f7;
  color: #000000;
}
#T_6ebc4_row0_col8, #T_6ebc4_row0_col9, #T_6ebc4_row0_col15, #T_6ebc4_row0_col17, #T_6ebc4_row0_col21 {
  min-width: 80px;
  background-color: #fdfdfe;
  color: #000000;
}
#T_6ebc4_row0_col10, #T_6ebc4_row0_col12, #T_6ebc4_row0_col18, #T_6ebc4_row0_col19 {
  min-width: 80px;
  background-color: #fffdfc;
  color: #000000;
}
#T_6ebc4_row0_col11 {
  min-width: 80px;
  background-color: #fafbfd;
  color: #000000;
}
#T_6ebc4_row0_col13 {
  min-width: 80px;
  background-color: #fef9f9;
  color: #000000;
}
#T_6ebc4_row0_col20 {
  min-width: 80px;
  background-color: #fefeff;
  color: #000000;
}
</style>

<div id="T_6ebc4" class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_6ebc4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Model Coefficients
</figcaption>
<div aria-describedby="T_6ebc4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="T_6ebc4" class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_6ebc4_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">npl-1q</th>
<th id="T_6ebc4_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">npl-2q</th>
<th id="T_6ebc4_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Gross domestic product (GDP) (2015 = 100)-0y</th>
<th id="T_6ebc4_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Gross domestic product (GDP) (2015 = 100)-1y</th>
<th id="T_6ebc4_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">Gross domestic product (GDP) (percentage change on previous)-0y</th>
<th id="T_6ebc4_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">Gross domestic product (GDP) (percentage change on previous)-1y</th>
<th id="T_6ebc4_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">Unemployment Rate-0q</th>
<th id="T_6ebc4_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">Unemployment Rate-1q</th>
<th id="T_6ebc4_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">Unemployment Rate-2q</th>
<th id="T_6ebc4_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">House price index (2015 = 100)-0q</th>
<th id="T_6ebc4_level0_col10" class="col_heading level0 col10" data-quarto-table-cell-role="th">House price index (2015 = 100)-1q</th>
<th id="T_6ebc4_level0_col11" class="col_heading level0 col11" data-quarto-table-cell-role="th">House price index (2015 = 100)-2q</th>
<th id="T_6ebc4_level0_col12" class="col_heading level0 col12" data-quarto-table-cell-role="th">Harmonised Index of Consumer Prices (annual rate of change)-0q</th>
<th id="T_6ebc4_level0_col13" class="col_heading level0 col13" data-quarto-table-cell-role="th">Harmonised Index of Consumer Prices (annual rate of change)-1q</th>
<th id="T_6ebc4_level0_col14" class="col_heading level0 col14" data-quarto-table-cell-role="th">Harmonised Index of Consumer Prices (annual rate of change)-2q</th>
<th id="T_6ebc4_level0_col15" class="col_heading level0 col15" data-quarto-table-cell-role="th">Private sectror credit flow-0y</th>
<th id="T_6ebc4_level0_col16" class="col_heading level0 col16" data-quarto-table-cell-role="th">Private sectror credit flow-1y</th>
<th id="T_6ebc4_level0_col17" class="col_heading level0 col17" data-quarto-table-cell-role="th">Money Market Interest Rate-0q</th>
<th id="T_6ebc4_level0_col18" class="col_heading level0 col18" data-quarto-table-cell-role="th">Money Market Interest Rate-1q</th>
<th id="T_6ebc4_level0_col19" class="col_heading level0 col19" data-quarto-table-cell-role="th">Money Market Interest Rate-2q</th>
<th id="T_6ebc4_level0_col20" class="col_heading level0 col20" data-quarto-table-cell-role="th">Consumer confidence indicator-0q</th>
<th id="T_6ebc4_level0_col21" class="col_heading level0 col21" data-quarto-table-cell-role="th">Consumer confidence indicator-1q</th>
<th id="T_6ebc4_level0_col22" class="col_heading level0 col22" data-quarto-table-cell-role="th">Consumer confidence indicator-2q</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_6ebc4_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">Coefficient</th>
<td id="T_6ebc4_row0_col0" class="data row0 col0">0.5103</td>
<td id="T_6ebc4_row0_col1" class="data row0 col1">-0.0656</td>
<td id="T_6ebc4_row0_col2" class="data row0 col2">-0.1094</td>
<td id="T_6ebc4_row0_col3" class="data row0 col3">0.0877</td>
<td id="T_6ebc4_row0_col4" class="data row0 col4">0.0410</td>
<td id="T_6ebc4_row0_col5" class="data row0 col5">-0.0030</td>
<td id="T_6ebc4_row0_col6" class="data row0 col6">0.0097</td>
<td id="T_6ebc4_row0_col7" class="data row0 col7">-0.0160</td>
<td id="T_6ebc4_row0_col8" class="data row0 col8">0.0055</td>
<td id="T_6ebc4_row0_col9" class="data row0 col9">0.0068</td>
<td id="T_6ebc4_row0_col10" class="data row0 col10">-0.0061</td>
<td id="T_6ebc4_row0_col11" class="data row0 col11">0.0148</td>
<td id="T_6ebc4_row0_col12" class="data row0 col12">-0.0049</td>
<td id="T_6ebc4_row0_col13" class="data row0 col13">-0.0121</td>
<td id="T_6ebc4_row0_col14" class="data row0 col14">0.0104</td>
<td id="T_6ebc4_row0_col15" class="data row0 col15">0.0041</td>
<td id="T_6ebc4_row0_col16" class="data row0 col16">0.0095</td>
<td id="T_6ebc4_row0_col17" class="data row0 col17">0.0043</td>
<td id="T_6ebc4_row0_col18" class="data row0 col18">-0.0060</td>
<td id="T_6ebc4_row0_col19" class="data row0 col19">-0.0042</td>
<td id="T_6ebc4_row0_col20" class="data row0 col20">0.0001</td>
<td id="T_6ebc4_row0_col21" class="data row0 col21">0.0052</td>
<td id="T_6ebc4_row0_col22" class="data row0 col22">-0.0007</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
<p><strong>Table 2.</strong> Model coefficients for all the variables and time delays.</p>
<div id="ac49b151-9cd0-4170-83f5-51013a007297" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plot_abs_coeff_series_by_dataset(model, feature_names<span class="op">=</span>data.drop(columns<span class="op">=</span>[<span class="st">'npl'</span>]).columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="TimeSeriesModelling_files/figure-html/cell-7-output-1.png" width="1089" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 3.</strong> Comparison of the magnitudes of influence coefficients for different variables at different delays (see the Model section). The plot shows absolute values in a log-linear scale. Marker style denotes the sign of the coefficient as explained by the legend. We see that the previous values of the NPL and GDP are an order of magnitude more important than other macroeconomic variables.</p>
</section>
<section id="conclusions" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>In this study, we developed a linear delayed-action model to describe and predict the Non-Performing Loans (NPL) of Nova Ljubljanska Banka based on key macroeconomic variables. The model demonstrates strong explanatory power within the modelling period, achieving an <span class="math inline">\(R^2\)</span> score of 0.86, and successfully reproduces the main NPL regimes associated with the Euro crisis and the subsequent recovery period.</p>
<p>Our analysis identifies Gross Domestic Product, Unemployment Rate, and House Price Index as the primary macroeconomic drivers of NPL dynamics, reflecting the close link between credit risk and the broader economic environment. The inclusion of delayed terms proves essential for capturing the temporal dependencies in the data.</p>
<p>However, the modelâ€™s predictive capability is limited to approximately two quarters ahead, beyond which accuracy rapidly deteriorates. This limitation likely stems from the modelâ€™s linear nature and the relatively small dataset. Future work could explore nonlinear or hybrid approaches, incorporate additional regional data, or include stress-testing scenarios to improve robustness and forecasting horizons.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>